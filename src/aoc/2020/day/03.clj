(ns aoc.2020.day.03
  (:require [clojure.test :refer [with-test is run-tests]]
            [clojure.string :as s]))

(def input-3 ".........#.#.#.........#.#.....\n...#......#...#.....#.....#....\n#.....#.....#.....#.#........#.\n......#..#......#.......#......\n.#..........#.............#...#\n............#..##.......##...##\n....#.....#..#....#............\n.#..#.........#....#.#....#....\n#.#...#...##..##.#..##..#....#.\n.#.......#.#...#..........#....\n...#...#........##...#..#.....#\n..................#..........#.\n.....#.##..............#.......\n........#....##..##....#.......\n...#.....#.##..........#...##..\n.......#.#....#............#...\n..............#......#......#..\n#.......#...........#........##\n.......#.......##......#.......\n................#....##...#.#.#\n#.......#....................#.\n.##.#..##..#..#.#.....#.....#..\n#...#............#......##....#\n.#....##.#......#.#......#..#..\n..........#........#.#.#.......\n...#...#..........#..#....#....\n..#.#...#...#...##...##......#.\n......#...#........#.......###.\n....#...............#.###...#.#\n..................#.....#..#.#.\n.#...#..#..........#........#..\n#..........##................##\n...#.....#...#......#.#......#.\n......#..........#.#......#..#.\n..#......#.....................\n............#.........##.......\n......#.......#........#.......\n#.#...#...........#.......#....\n.#.#........#.#.#....#........#\n#.....##........#.#.....#.#....\n.#...#..........##...#.....#..#\n.........#....###............#.\n..#...#..............#.#.#.....\n.....#.#.#..#.#.#.###......#.#.\n.#.##...#.......###..#.........\n.....##....#.##..#.##..#.......\n..#...........##......#..#.....\n................##...#.........\n##.....................#..#.###\n...#..#....#...........#.......\n.#.............##.#.....#.#....\n.......#.#.#....##..#....#...#.\n...##..#..........#....#.......\n....##......#.........#........\n.##....#...........#.#.......#.\n...#...#.##.......#.#..........\n..#.........#.##...........#...\n....#.##........#.......#...##.\n...................#..#..#...##\n#...#......###..##.#..###......\n#.............#.#........#...#.\n...#...#..#..#..............#..\n#.....#..#...#...#......#.#..#.\n...##.............#........##.#\n......#.#.........#.#....#...#.\n........##............#...#....\n............#.#...#......#.....\n...#...........#...#...........\n.........#.#......#............\n....#.............#..#.....#..#\n#.....#...........#.....#.#.#.#\n.............#.....##......#...\n...................###.#......#\n#.##.....#...#..#..#...#....#..\n............#.....#....#.#.....\n#....#..#..........#....#..#...\n..........##..................#\n....#.......###..#......###....\n.......#...#.##.##..#....##....\n...##...............#.....#...#\n#...........#...#......#..#..#.\n..##....#.......#...#.....#....\n.......##..............#.##..#.\n.#......#..........#.......#...\n....##...................#.#..#\n......#....###................#\n.#........#...........#........\n.#.....##....#..##...........#.\n##..............##...#.......#.\n......#..........#..........##.\n..#.....#.#.........####....#..\n.............#......#......#...\n..#.............#...........##.\n#.#...#........#..........##...\n...#....#.....#.....#.....##...\n......#........................\n......#..#...#......#.....#....\n......#....##.....#....#.......\n#.#......#.##..#...............\n..........#.#.##..##..#........\n......#.#..#....###.#..........\n........................#....#.\n#.#.............#....#.....##.#\n.#.#..........#.......#..#....#\n..#...#......#..#..#...#.#...#.\n...#.##...###..................\n........#.#...........#...#....\n........#..........#....#......\n#....#........#.......##.....#.\n......###...##...#......#......\n............#.......#.....##..#\n....#..#.......##......#.......\n#............##................\n...............#..#......#...#.\n.#....##...#......#............\n#...#................#.........\n..#....#..#........##......#...\n....#....###......##.#.......#.\n......#.#..#.#..#....#..#......\n....#..........#..#..#.........\n.#..#.......#......#........#..\n.......#..#..#............#....\n.............#...#....#..#.....\n..............#.#.#.........#..\n#.....##.......#....#..........\n...#.....#......#..............\n...##.#..#.#........#..##....#.\n.......#.#.....##..#...........\n.....#.#....#..................\n.#......#.###..............##..\n..#....#...#..#...##...##....#.\n..........##..#...#..#.........\n..#............#........#.#...#\n.........................#.#.#.\n......#........#.#..#......##.#\n#.#......#..#.........#........\n.....#........#......#...#.#...\n........##....##....#.#........\n....#....#.#...#...##....#..#..\n#.............#.....#..........\n#............##..#............#\n..#.#......#........#..........\n.#......#......#.#.##.##.......\n..#.....#..........#......##...\n...#......#...#.##....#.....##.\n......#......#...........#.#...\n....#........#..#..#........#.#\n....#.........#.....#...#.#.#..\n....#.....###........#.........\n.............##........#.#.....\n...#............#........#.#.#.\n......#....#.......#.#.........\n.....#................#........\n.#....#..#.#.............#...#.\n#..##...#............#......#..\n...#..#........................\n.#.#...........#.......#.......\n#....###............##.........\n...##....#.#............##.....\n.........####......#........#..\n.....#.......#.#...............\n.......#...#.###..#....#...#..#\n...#.....##..#....#..#.#...###.\n.............#........#.#.#..#.\n................#..........##..\n.......####..##..##........##.#\n..#......#..#..#.#.##..........\n#....#........#....#...###.#.#.\n........##........##.....#.....\n...........#.#...........#....#\n#.............#...........#....\n...#.........#...#....#.....#..\n..##......#...#...............#\n.............#.........#....#..\n..#...........#..#........#.##.\n.#.#......#.............##...#.\n.#......#.....##.#..#..#.......\n....##......#..................\n.#.#..##............#....#....#\n........#...##.............#..#\n........#....##.....#......###.\n.........#....#.#..............\n#.....#........................\n.#..#....#.....#......#.###..#.\n..........#...#....##....#..#..\n...#.#.#...##..#..#......#..#.#\n#............#.....#....#......\n#.###...#.#......###..#....#..#\n...#.###........#......#....#..\n..#.##...#.........#.#.........\n............##.................\n....#..........#.#.#.#.#....#..\n...##.#...#.......#.......##..#\n....##.#........#....#...#.....\n.............#.#....#...#.....#\n...#......................##...\n..#...#.....#.....#........#..#\n..#..#.......#....#..##.....#..\n..#..#.#.......................\n.......##..#....#....#..#......\n....#......##....#............#\n.#...#..#..#.##...#.#...#......\n.....#......#....#.........#...\n.##......##.........#....#.....\n#...........#...##.....#......#\n.....#.#.......#.........#.....\n.........#..........#..####.##.\n............#..#......#.#......\n.#.............#........#.#....\n......#......#...#..#....#####.\n.........##.#..##...###..#....#\n....#.#....#.#..#.........#....\n..#.............#...##...##....\n........#..........#.##..#....#\n.....#...#..##........#.#..#...\n##..#.#.....#............#.....\n.............#........##...##..\n#......####.....##.............\n..##.....##....###..#.#....#...\n......##.##.#...#..#.#..##.....\n......#.................#......\n#.....#.#...#......#.#....#....\n....#.#........#..............#\n##........#.......##.#...##...#\n..#..................#.#....#..\n...........#..........#.#.....#\n........##.#.....#......#..#..#\n.....#....#..#.....#.........##\n#.#..#..#...#......#..........#\n#...##.....#..#.#.......#.##...\n..#....##...............#......\n#..........#.#.........#.#....#\n..............#......#....#....\n.....#...........#...#...#...#.\n...#......#....#....#..........\n.#..........#.#....##..##....#.\n..............#.........#.#....\n.......#.....#.....#...##....#.\n##.#.........#....#.....#.#....\n....#..#......#................\n......##.....#.......##........\n.....##...#........#...#...#...\n..#...#...#..#..#.#......#..#..\n....#...#.......#..............\n....#..#.........###........#..\n....#.............##..#........\n..........##.#.......##..##....\n#.##..................#.....#..\n#........#........#.....#......\n.#...#......#..................\n#....##.##......#...#.........#\n......#.##..##................#\n............#.........##.......\n..........####.#........#.....#\n.##...#...#....#..#............\n.#.##...#..#...#......#......##\n.....#.#....#..###......#.#.#..\n...#.......................##..\n......................#.......#\n..#....#.........#..#.#.....#..\n.#....#..#....#...#............\n..........#...##.....#.#..#....\n........#..#..#....#...#...#...\n.....#......#.#................\n.....#...........#...#.........\n.....#...##..#.#....#..#.....#.\n#.......#.............##.......\n................#....#.#..#....\n.#..##...#.#........#......#.#.\n.#.##..........#...............\n....##......#....#........#....\n....#..#....#.##.#.............\n.......#..#......##.#.....#....\n.......#.....#.............#...\n.....#....#.......#............\n........#.#...##..##..##.......\n#.........##....##...##........\n........#..#.#..........###.#..\n..........................#.#..\n#.....#.......#..#........#....\n...##.....#.......#......#.....\n.#.#..#...........#...........#\n.....##..#........#...####.....\n.#.#...##.#.#..#..#.#..#.......\n..#.##.#...#.#.#...#..#........\n............#..........#..#....\n...............#..##.#.........\n.............#.....#....#......\n...##..##......##..........#...\n..#.......#....#..........#...#\n.##................#.#.#.......\n.....##.....#..#.....#.........\n......#.#.......#......#..#....\n.....#.....#........#.......##.\n......#.......##......#...#...#\n....#...........###.........#..\n...#.....#.........##........#.\n..#.....#..............#.......\n....#.......#...#....#....#..##\n......#...........#...........#\n.##......#......#.#.....#.##...\n....#..##......#...#..#.#.###..\n.......#.#....#......#..#......\n..........#........#...........\n#.##.........#.#.#...#...#.#...\n.#......###.....#....#.#....#..\n...................##..#.......\n....#..#..............#.#.....#\n#..................#.....#.....\n...........##.##.......#..#.#..\n........#.#......#...........#.\n#..#.......#...#...........#.#.\n......##...........#...........\n.........#.#........#........#.\n#......#....#.#.....#..#.......\n............#..#.....##...#....\n.#......#..#......#.........#..\n.......#...#.........#.##.....#\n........................#..#...\n.###..............#.#..#.......\n.....#.........#.......#......#\n..##..##....#.....#.......#.#..\n...###.#..#.##............#....")
(def test-input-3 "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#...##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#")

(defn pre-parse-3 [input]
  (->> (s/split-lines input)
       (map vec)
       (vec)))

(with-test
  (defn algo-3a
    ([input] (algo-3a input [1 3]))
    ([input [slope-r slope-c :as slope]]
     (let [board (pre-parse-3 input)
           height (count board)
           width (count (first board))
           coords (->> (iterate (fn [[r c]]
                                  (let [[r' c'] (map + [r c] slope)
                                        c' (mod c' width)]
                                    [r' c']))
                                [0 0])
                       (take height))]
       (reduce (fn [ct coord]
                 (let [spot (get-in board coord)]
                   (if (= spot \#) (inc ct) ct)))
               0
               coords))))
  (is (= (algo-3a test-input-3)
         7)))

(with-test
  (defn algo-3b [input]
    (let [slopes [[1 1] [1 3] [1 5] [1 7] [2 1]]
          trees (map (partial algo-3a input) slopes)]
      (apply * trees)))
  (is (= (algo-3b test-input-3)
         336)))


(def soln-3a (algo-3a input-3))
(comment (prn soln-3a))

(def soln-3b (algo-3b input-3))
(comment (prn soln-3b))


